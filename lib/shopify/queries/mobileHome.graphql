# Reuse your shared fragments (same file you already import elsewhere)
# import "../fragments.graphql"

query MobileHome($handle: String!, $language: LanguageCode) @inContext(language: $language) {
  metaobject(handle: { handle: $handle, type: "mobile_home" }) {
    id
    type
    fields {
      key
      value
      references(first: 250) {
        nodes {
          __typename
          # sections should be Metaobject references â€” narrow to Metaobject
          ... on Metaobject {
            id
            type
            fields {
              key
              value
              references(first: 250) {
                nodes {
                  __typename
                  ... on MediaImage {
                    image {
                      ...Image
                    }
                  }
                  ... on Collection {
                    handle
                    title
                    image {
                      ...Image
                    }
                  }
                  ... on Product {
                    handle
                    title
                    featuredImage {
                      ...Image
                    }
                  }
                }
              }
              reference {
                __typename

                # Poster image, etc.
                ... on MediaImage {
                  image {
                    ...Image
                  }
                }

                # Future rails / fallbacks
                ... on Collection {
                  handle
                  title
                  image {
                    ...Image
                  }
                }

                ... on Product {
                  handle
                  title
                  featuredImage {
                    ...Image
                  }
                }
              }
            }
          }

          # Allow list-of-collection fields to resolve directly here
          ... on Collection {
            handle
            title
            image {
              ...Image
            }
          }

          # And list-of-product/media fallbacks if ever needed
          ... on Product {
            handle
            title
            featuredImage {
              ...Image
            }
          }

          ... on MediaImage {
            image {
              ...Image
            }
          }
        }
      }
    }
  }
}
